#!/bin/bash
# Script tá»± Ä‘á»™ng cÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh realm vá»›i sá»‘ endpoint tÃ¹y chá»n

# Táº£i vÃ  cáº¥p quyá»n thá»±c thi
wget -O /root/realm https://tltvpn.com/tlt/realm
chmod +x /root/realm

# Há»i sá»‘ lÆ°á»£ng endpoint
read -p "Báº¡n muá»‘n cÃ i Ä‘áº·t bao nhiÃªu endpoint (chuyá»ƒn tiáº¿p)? " num_endpoints

# Kiá»ƒm tra náº¿u num_endpoints lÃ  sá»‘ há»£p lá»‡
if ! [[ "$num_endpoints" =~ ^[0-9]+$ ]] || [ "$num_endpoints" -le 0 ]; then
    echo "Lá»—i: Vui lÃ²ng nháº­p má»™t sá»‘ nguyÃªn dÆ°Æ¡ng lá»›n hÆ¡n 0!"
    exit 1
fi

# Táº¡o file realm.toml
cat > /root/realm.toml << EOF
[network]
no_tcp = false
use_udp = true
EOF

# Láº·p Ä‘á»ƒ há»i IP vÃ  port cho tá»«ng endpoint
for i in $(seq 1 $num_endpoints); do
    echo "Cáº¥u hÃ¬nh endpoint thá»© $i:"
    read -p "Nháº­p IP chuyá»ƒn tiáº¿p: " ip
    read -p "Nháº­p port chuyá»ƒn tiáº¿p: " port
    cat >> /root/realm.toml << EOF

[[endpoints]]
listen = "0.0.0.0:$port"
remote = "$ip:$port"
EOF
done

# Táº¡o file service
cat > /etc/systemd/system/realm.service << EOF
[Unit]
Description=Realm Forwarding Service
After=network-online.target
Wants=network-online.target systemd-networkd-wait-online.service

[Service]
Type=simple
User=root
Restart=on-failure
RestartSec=5s
ExecStart=/root/realm -c /root/realm.toml

[Install]
WantedBy=multi-user.target
EOF

# Cáº¥u hÃ¬nh vÃ  khá»Ÿi Ä‘á»™ng service
systemctl daemon-reload
systemctl enable realm
systemctl restart realm

echo "âœ… ÄÃ£ hoÃ n táº¥t cÃ i Ä‘áº·t vÃ  khá»Ÿi Ä‘á»™ng realm vá»›i $num_endpoints endpoint!"
echo "ðŸ” Äá»ƒ kiá»ƒm tra tráº¡ng thÃ¡i, cháº¡y: systemctl status realm"
